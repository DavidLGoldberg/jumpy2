schedules:
  - cron: '0 18 * * *'
    displayName: Daily 6PM build
    branches:
      include:
        - main

trigger:
  branches:
    include:
      - main
  tags:
    include:
      - v*

pool:
  vmImage: ubuntu-latest

steps:
  - bash: |
      /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 & echo '>>> Started xvfb'
    displayName: Start xvfb
    condition: and(succeeded(), eq(variables['Agent.OS'], 'Linux'))

  - bash: |
      sudo apt-get update && sudo apt-get install -y build-essential
      make test
    displayName: 'Build and test with Make'
    env:
      DISPLAY: ':99.0'
